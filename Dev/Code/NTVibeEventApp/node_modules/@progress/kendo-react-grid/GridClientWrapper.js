/**
 * @license
 *-------------------------------------------------------------------------------------------
 * Copyright Â© 2025 Progress Software Corporation. All rights reserved.
 * Licensed under commercial license. See LICENSE.md in the package root for more information
 *-------------------------------------------------------------------------------------------
 */
"use client";
"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const zt=require("react"),R=require("@progress/kendo-react-common"),Ft=require("@progress/kendo-data-query"),c=require("@progress/kendo-react-data-tools"),Nt=require("./drag/ColumnResize.js"),qt=require("./drag/CommonDragLogic.js"),Ut=require("./constants/index.js"),G=require("./utils/index.js"),jt=require("./VirtualScroll.js"),Bt=require("./contextMenu/GridContextMenu.js"),Fe=require("./contextMenu/enums.js"),Ne=require("./sortCommon.js"),Vt=require("./BasePDFExport.js"),Wt=require("./utils/GridContext.js"),_t=require("./filterCommon.js");function $t(t){const m=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const u in t)if(u!=="default"){const E=Object.getOwnPropertyDescriptor(t,u);Object.defineProperty(m,u,E.get?E:{enumerable:!0,get:()=>t[u]})}}return m.default=t,Object.freeze(m)}const a=$t(zt),Xt=(t,m,u,E)=>{const U=Object.keys(m.cells).map(S=>u.findIndex(L=>L.field===S)),O=Object.keys(m.cells).length>0?U:!0;return t.reduce((S,L)=>(S[L[E!=null?E:"id"]]=O,S),{})},Jt=(t,m,u,E)=>m.reduce((O,S)=>({...O,...Xt(Ft.filterBy(t,S),S,u,E)}),{}),Qt=t=>{const m=t.gridProps.isClient,[u,E]=a.useState({}),U=R.useAdaptiveModeContext(),O=a.useRef(null),S=e=>{e.event.preventDefault(),E({...u,show:!0,offset:{left:e.event.pageX,top:e.event.pageY},dataItem:e.dataItem,field:e.field})},L=()=>{E({})},v=a.useMemo(()=>t.columnsRef.find(e=>e.field===u.field),[t.columnsRef,u]),ye=a.useMemo(()=>{const e=t.gridProps.sortable&&(v==null?void 0:v.sortable);return G.getDefaultHeadContextMenuItems({pdf:!!t.gridProps.pdf,sortable:!!e,selectable:c.getSelectionOptions(t.gridProps.selectable).enabled,clipboard:!!t.gridProps.clipboard})},[v,t.gridProps.sortable,t.gridProps.selectable,t.gridProps.clipboard]),Se=a.useMemo(()=>{const e=t.gridProps.sortable&&(v==null?void 0:v.sortable);return G.getDefaultBodyContextMenuItems({pdf:!!t.gridProps.pdf,sortable:!!e,selectable:c.getSelectionOptions(t.gridProps.selectable).enabled,clipboard:!!t.gridProps.clipboard,rowReorderable:G.isRowReorderEnabled(t.gridProps.rowReorderable)})},[v,t.gridProps.sortable,t.gridProps.selectable,t.gridProps.clipboard]),Y=a.useMemo(()=>{const e=(v==null?void 0:v.contextMenu)||t.gridProps.contextMenu,n=typeof e=="function"?e(u):e;if(n&&u.offset){const o=u.dataItem?Fe.GridContextMenuAnchorPart.body:Fe.GridContextMenuAnchorPart.head,r=n[o],i=u.dataItem?Se:ye;return r===!1?void 0:r===!0||r===void 0?i:r}},[t.gridProps.contextMenu,u,Se,ye,v]),qe=e=>{var l,g,f,b,y,de,I,X,J;const n=e.event.item,o={target:w.current,syntheticEvent:e.event.syntheticEvent,nativeEvent:e.event.nativeEvent,menuItem:n,...e};t.gridProps.onContextMenuItemClick&&s(t.gridProps.onContextMenuItemClick,o);const r=x(),i={selectedField:"",componentId:t.id,dataItems:r,dataItem:e.dataItem,startRowIndex:-1,endRowIndex:-1,startColIndex:-1,endColIndex:-1,ctrlKey:!1,altKey:!1,metaKey:!1,shiftKey:!1,isDrag:!1,...c.getSelectionOptions(t.gridProps.selectable),...o},d=r.findIndex(Q=>Q===e.dataItem);switch((l=n.data)==null?void 0:l.action){case"SortCommand":if(v){const Q=(g=n.name)==null?void 0:g.toLowerCase().includes("asc"),Gt=((f=n.name)==null?void 0:f.toLowerCase().includes("desc"))?"desc":void 0,Ot=Q?"asc":Gt,Lt=n.name?Ot:void 0;xe(e.event.syntheticEvent,v,Lt)}break;case"SelectRowCommand":it(i);break;case"SelectAllRowsCommand":ot(i);break;case"ExportPDFCommand":ce();break;case"ClearSelectionCommand":at(i);break;case"ReorderRowCommand":$.current=e.dataItem,(b=n.name)!=null&&b.toLowerCase().includes("rowup")&&d>0&&j(e.event.syntheticEvent,d-1,"before"),(y=n.name)!=null&&y.toLowerCase().includes("rowdown")&&d<r.length-1&&j(e.event.syntheticEvent,d+1,"after"),(de=n.name)!=null&&de.toLowerCase().includes("rowtop")&&j(e.event.syntheticEvent,0,"before"),(I=n.name)!=null&&I.toLowerCase().includes("rowbottom")&&j(e.event.syntheticEvent,r.length-1,"after");break;case"CopySelectionCommand":te(c.ClipboardActionType.copy,e.event.nativeEvent,{copyHeaders:!((X=n.name)!=null&&X.toLowerCase().includes("noheaders"))},e.dataItem,e.field);break;case"PasteCommand":te(c.ClipboardActionType.paste,e.event.nativeEvent,{copyHeaders:!((J=n.name)!=null&&J.toLowerCase().includes("noheaders"))},e.dataItem,e.field);break}L()},Z=()=>{const e=t.columnsRef.filter(n=>n.declarationIndex>=0&&n.parentIndex===-1);return G.sanitizeColumns(e)},Ue=(e,n,o)=>{if(t.gridProps.onContextMenu&&m){const r={target:w.current,syntheticEvent:e,nativeEvent:e.nativeEvent,dataItem:n,field:o};s(t.gridProps.onContextMenu,r)}t.gridProps.contextMenu&&S({event:e,dataItem:n,field:o})},je=e=>{if(e.target!==e.currentTarget)return;clearTimeout(Ce.current),h.current&&(h.current.table=A.current);const n=e.currentTarget.scrollLeft,o=e.currentTarget.scrollTop;t.gridProps.columnVirtualization&&(!K||o===ve.current)&&(Ce.current=window.setTimeout(()=>{B()},0)),t.gridProps.scrollLeftRef&&(t.gridProps.scrollLeftRef.current=n),_.current&&_.current.setScrollLeft(n),W.current&&W.current.setScrollLeft(n),h.current&&o!==ve.current&&h.current.scrollHandler(e),t.gridProps.onScroll&&m&&s(t.gridProps.onScroll,{...P(e)}),ve.current=o},Be=e=>{c.tableKeyboardNavigation.onKeyDown(e,{navigatable:t.gridProps.navigatable||!1,contextStateRef:T,navigationStateRef:F,onNavigationAction:We,columns:Z()}),c.tableKeyboardNavigation.onGetSnapshotBeforeUpdate({document:D(),contextStateRef:T,navigationStateRef:F});const n={dataItems:x(),mode:C.mode,cell:C.cell,componentId:t.id,selectedField:"",...P(e)};t.gridProps.onKeyDown&&m&&s(t.gridProps.onKeyDown,n)},Ve=e=>{c.tableKeyboardNavigation.onFocus(e,{navigatable:!!t.gridProps.navigatable,contextStateRef:T})},We=e=>{if(e.action==="moveToNextPage"&&st(e.event),e.action==="moveToPrevPage"&&ut(e.event),e.focusElement&&e.action==="reorderToRight"){const n=parseInt(e.focusElement.ariaColIndex,10)-1;n<t.columnsRef.length-1&&ue(n,n+1,e.event)}if(e.focusElement&&e.action==="reorderToLeft"){const n=parseInt(e.focusElement.ariaColIndex,10)-1;n>0&&ue(n,n-1,e.event)}if(e.action==="select"&&tt(e.event),t.gridProps.onNavigationAction&&m){const n={focusElement:e.focusElement,...P(e.event)};s(t.gridProps.onNavigationAction,n)}},_e=(e,n)=>{t.gridProps.onRowClick&&e.target.nodeName==="TD"&&s(t.gridProps.onRowClick,{dataItem:n,...P(e)})},$e=(e,n)=>{t.gridProps.onRowDoubleClick&&e.target.nodeName==="TD"&&s(t.gridProps.onRowDoubleClick,{dataItem:n,...P(e)})},Xe=e=>{t.gridProps.onItemChange&&s(t.gridProps.onItemChange,{...P(e.syntheticEvent),dataItem:e.dataItem,field:void 0,value:void 0})},Je=e=>{t.gridProps.onItemChange&&t.gridProps.onEditChange&&s(t.gridProps.onEditChange,{edit:{},...P(e.syntheticEvent)})},Qe=(e,n,o)=>{if(ze.enabled&&ze.mode==="incell"&&t.gridProps.dataItemKey){const r=c.editReducer(t.gridProps.edit,{type:c.EDIT_ACTION.ENTER_FIELD_EDIT,payload:{id:n[t.gridProps.dataItemKey],field:o}});t.gridProps.onEditChange&&s(t.gridProps.onEditChange,{edit:r,...P(e)})}},Ye=(e,n)=>{var r;if(c.getDetailExpandableOptions(t.detailExpandable).enabled){const i=c.detailExpandReducer((r=t.gridProps.detailExpand)!=null?r:{},e);t.gridProps.onDetailExpandChange&&s(t.gridProps.onDetailExpandChange,{...P(n),detailExpand:i})}},Ze=(e,n)=>{var r;const o=c.getGroupExpandableOptions(typeof t.gridProps.groupable=="object"?t.gridProps.groupable.expandable!==!1:t.gridProps.groupable);if(o.enabled){const i=c.groupExpandReducer((r=t.gridProps.groupExpand)!=null?r:[],e,o);t.gridProps.onGroupExpandChange&&s(t.gridProps.onGroupExpandChange,{...P(n),groupExpand:i})}},xe=(e,n,o)=>{const{allowUnsort:r,mode:i}=Ne.normalizeSortable(t.gridProps.sortable||!1,n.sortable||!1),d=(t.gridProps.sort||[]).filter(f=>f.field===n.field)[0],l=o||Ne.firstLevelSortSeqMap[r][d&&d.dir||""],g=i==="single"?[]:(t.gridProps.sort||[]).filter(f=>f.field!==n.field);l!==""&&n.field&&g.push({field:n.field,dir:l}),De(g,e)},pe=e=>{t.gridProps.onItemChange&&s(t.gridProps.onItemChange,{...P(e.syntheticEvent),dataItem:e.dataItem,dataIndex:e.dataIndex,field:e.field,value:e.value})},et=e=>{var n;if(t.gridProps.onSelectionChange&&C.enabled){const{event:o,dataItem:r,dataIndex:i,columnIndex:d}=e,l={...P(o),dataItem:r,startColIndex:d,endColIndex:d,startRowIndex:i,endRowIndex:i,dataItems:x(),altKey:!1,ctrlKey:!1,shiftKey:!1,metaKey:!1,mode:C.mode,cell:C.cell,isDrag:!1,componentId:t.id,selectedField:""};s(t.gridProps.onSelectionChange,{...l,select:t.gridProps.dataItemKey?c.getSelectedState({event:l,selectedState:(n=t.gridProps.select)!=null?n:{},dataItemKey:t.gridProps.dataItemKey}):{}})}},tt=e=>{var f,b;if(!C.enabled||!t.gridProps.dataItemKey)return;const n={dataItems:x(),mode:C.mode,cell:C.cell,componentId:t.id,selectedField:"",...P(e)},o=c.getSelectedStateFromKeyDown({event:n,selectedState:(f=t.gridProps.select)!=null?f:{},dataItemKey:t.gridProps.dataItemKey});if(o===t.gridProps.select)return;const r=e.target,i=c.closestTagName(r,"TD"),d=c.closestTagName(r,"TR"),l=c.getColumnIndex(i),g=c.getRowIndex(d);if(l!==void 0&&g!==void 0){const y=(b=G.getDataAsArray(t.gridProps.data))==null?void 0:b[g];t.gridProps.onSelectionChange&&s(t.gridProps.onSelectionChange,{...n,select:o,dataItem:y,startRowIndex:g,startColIndex:l,startDataItem:y,endDataItem:y,endRowIndex:g,endColIndex:l,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,shiftKey:e.shiftKey,isDrag:!1})}},nt=e=>{if(t.gridProps.onHeaderSelectionChange&&C.enabled){const n=x();s(t.gridProps.onHeaderSelectionChange,{select:e.syntheticEvent.target.checked?n.reduce((o,r)=>(t.gridProps.dataItemKey&&R.getter(t.gridProps.dataItemKey)(r)!==void 0&&(o[R.getter(t.gridProps.dataItemKey)(r)]=!0),o),{}):{},field:e.field,nativeEvent:e.syntheticEvent&&e.syntheticEvent.nativeEvent,syntheticEvent:e.syntheticEvent,target:w.current,dataItems:n})}},p=(e,n)=>{t.gridProps.onSelectionChange&&C.enabled&&s(t.gridProps.onSelectionChange,{...e,select:n})},rt=e=>{var n;if(t.gridProps.onSelectionChange&&C.enabled){const o=x()[e.startRowIndex],r=x()[e.endRowIndex],i={syntheticEvent:void 0,target:w.current,selectedField:"",componentId:t.id,dataItems:x(),dataItem:null,startDataItem:o,endDataItem:r,...e},d=c.getSelectedState({event:i,selectedState:(n=t.gridProps.select)!=null?n:{},dataItemKey:t.gridProps.dataItemKey});p(i,d)}},ot=e=>{if(t.gridProps.onSelectionChange&&C.enabled){const n=e.dataItems[0],o=e.dataItems[e.dataItems.length-1],r={},i={...e,startDataItem:n,endDataItem:o,startRowIndex:0,endRowIndex:e.dataItems.length-1,startColIndex:0,endColIndex:t.columnsRef.length-1};e.dataItems.forEach(d=>{const g=R.getter(t.gridProps.dataItemKey)(d);r[g]=e.cell?[...Array(t.columnsRef.length).keys()]:!0}),p(i,r)}},it=e=>{if(t.gridProps.onSelectionChange&&C.enabled){const o=R.getter(t.gridProps.dataItemKey)(e.dataItem),r=0,i=t.columnsRef.length-1,d=e.dataItems.findIndex(y=>y[t.gridProps.dataItemKey]===e.dataItem[t.gridProps.dataItemKey]),f={...e,startDataItem:d,endDataItem:d,startRowIndex:d,endRowIndex:d,startColIndex:r,endColIndex:i},b=e.mode==="multiple"?t.gridProps.select||{}:{};b[o]===!0||Array.isArray(b[o])&&b[o].length===t.columnsRef.length?delete b[o]:b[o]=e.cell?[...Array(t.columnsRef.length).keys()]:!0,p(f,b)}},at=e=>{t.gridProps.onSelectionChange&&C.enabled&&p(e,{})},z=(e,n,o,r,i)=>{lt();const d=t.gridProps.onDataStateChange;if(e){const l={...P(r),...n,targetEvent:i};s(e,l)}else d&&s(d,{...P(r),targetEvent:i||{},dataState:{...Et(),...o}})},ee=(e,n,o)=>{var r;K&&t.gridProps.pageable&&((r=h.current)==null||r.reset()),z(t.gridProps.onPageChange,{page:e},{skip:e.skip,take:e.take},n,o)},dt=(e,n,o)=>{var r;t.gridProps.pageable||(r=t.gridProps.group)!=null&&r.length?t.gridProps.virtualSkipRef&&(t.gridProps.virtualSkipRef.current=e.skip,B()):ee(e,n,o)},ct=()=>{let e=t.gridProps.total||0;return Array.isArray(t.gridProps.data)?e=e||t.gridProps.data.length:t.gridProps.data&&(e=e||t.gridProps.data.total),e},lt=()=>{K&&t.gridProps.virtualSkipRef&&(t.gridProps.virtualSkipRef.current=0)},st=e=>{var i,d;const n=(d=(i=t.gridProps.take)!=null?i:t.gridProps.pageSize)!=null?d:0,o=(t.gridProps.skip||0)+n,r=ct();o<r&&ee({skip:o,take:n},e)},ut=e=>{var r,i;const n=(i=(r=t.gridProps.take)!=null?r:t.gridProps.pageSize)!=null?i:0,o=(t.gridProps.skip||0)-n;o>=0&&ee({skip:o,take:n},e)},gt=e=>{ee({skip:e.skip,take:e.take},e.syntheticEvent,e.targetEvent)},De=(e,n)=>{z(t.gridProps.onSortChange,{sort:e},{sort:e,...K&&!t.gridProps.pageable?{skip:0}:{}},n)},ft=(e,n)=>{z(t.gridProps.onFilterChange,{filter:e},{filter:e,skip:0},n)},mt=e=>{if(!e||e.length===0){ke({});return}const n=Jt(t.gridProps.data,e,t.columnsRef,t.gridProps.dataItemKey);ke({...n})},ke=e=>{z(t.gridProps.onHighlightChange,{highlight:e},{},{})},Pt=e=>{const n=t.gridProps.searchFields||t.columnsRef.map(i=>i.field)||[],o=e.nativeEvent.target.value,r={logic:"or",filters:n.filter(i=>i!==void 0).map(i=>{var d;return typeof i=="string"?{field:i,value:o,operator:"contains"}:{value:o,operator:(d=i.operator)!=null?d:"contains",field:i.field,ignoreCase:i.ignoreCase}})};z(t.gridProps.onSearchChange,{search:r},{},e.syntheticEvent)},ce=()=>{var e;(e=O.current)==null||e.save()},ht=async e=>{var n,o;(n=t.gridProps)!=null&&n.onPdfExport&&await((o=t.gridProps)==null?void 0:o.onPdfExport(e))},le=(e,n)=>{const o=n.nativeEvent?n:{nativeEvent:n.nativeEvent||n.originalEvent};let r={};t.isVirtualScroll&&e.length&&!t.gridProps.pageable&&(r={take:void 0}),e.length===0&&t.gridProps.navigatable&&(he.current=!0),z(t.gridProps.onGroupChange,{group:e},{group:e,skip:0,...r},o)},se=e=>{if(t.gridProps.onColumnsStateChange){const n={target:w.current,columnsState:e};s(t.gridProps.onColumnsStateChange,n)}},ue=(e,n,o)=>{const{columnsRef:r,columnsState:i}=t,d=r[e],l=G.getFlatColumnsState(i),g=d.depth,f=I=>{do I++;while(I<r.length&&r[I].depth>g);return I},b=r.splice(e,f(e)-e);r.splice(e<n?f(n-b.length):n,0,...b),r.filter(I=>I.declarationIndex>=0).forEach((I,X)=>{I.orderIndex=X;const J=l.find(Q=>Q.id===I.id);J&&(J.orderIndex=X)});const y=r[e].locked&&r[n].locked;c.updateLeft(t.columnsMapRef,r,y||ie.current),c.updateRight(t.columnsMapRef,r,y||ie.current),Pe.current&&(ie.current=!1,Pe.current=!1);const de=Z();if(B(),t.gridProps.onColumnReorder){const I={target:w.current,columns:de,columnId:d.id,nativeEvent:o};s(t.gridProps.onColumnReorder,I)}se(i)},j=(e,n,o)=>{const r=typeof t.gridProps.rowReorderable=="object"?t.gridProps.rowReorderable.enabled:t.gridProps.rowReorderable;if(o==="forbidden"||!r||!$.current)return;const i=t.dataRef[n];t.gridProps.onRowReorder&&s(t.gridProps.onRowReorder,{draggedDataItems:[$.current],droppedDataItem:i==null?void 0:i.dataItem,dropPosition:o,nativeEvent:e.originalEvent,dragEvent:e,target:w.current}),$.current=null},bt=(e,n,o)=>{if(t.gridProps.group===void 0)return;const r=t.gridProps.group.slice();r.splice(n,0,...r.splice(e,1)),le(r,o)},Ke=(e,n,o)=>{const r=t.columnsRef[e].field;if(!r)return;const i=(t.gridProps.group||[]).slice();i.splice(n,0,{field:r}),le(i,o)},Rt=(e,n)=>{const o=M.current.getCurrentGroupsLength;Ke(e,o,n)},ge=()=>{let e=0;if(!k.current.colGroupMain)return;const n=k.current.colGroupMain.children;for(let o=0;o<n.length;o++){const r=n[o].width;if(!r){e=0;break}e+=parseFloat(r.toString())}e=Math.round(e),_.current&&_.current.setWidth(e),W.current&&W.current.setWidth(e),A.current&&(A.current.style.width=e?e+"px":"")},Me=()=>{var e;t.gridProps.widthRef&&(t.gridProps.widthRef.current=((e=H.current)==null?void 0:e.offsetWidth)||0)},Te=()=>{var e;t.gridProps.containerHeightRef&&(t.gridProps.containerHeightRef.current=((e=V.current)==null?void 0:e.offsetHeight)||0)},vt=()=>{const e=t.gridProps.minRowHeightRef;if(e&&!e.current&&!t.gridProps.rowHeight){const n=G.calcRowHeight(q.current);n&&(e.current=n,B())}},te=a.useCallback((e,n,o,r,i)=>{var f;if(!Ct()&&!o||!e)return;const d={type:e,nativeEvent:n,columns:t.columnsRef,dataItemKey:t.gridProps.dataItemKey||"",dataItem:r,field:i,...typeof t.gridProps.clipboard!="boolean"?t.gridProps.clipboard:{},...o},l=x(),g=c.populateClipboardData({event:d,data:l,selectedState:(f=t.gridProps.select)!=null?f:{},previousCopiedItems:Oe.current});e!==c.ClipboardActionType.paste&&(Oe.current=g.copiedItems),t.gridProps.onClipboard&&m&&s(t.gridProps.onClipboard,{...d,...g})},[t.gridProps.select,t.gridProps.dataItemKey,t.gridProps.data,t.gridProps.clipboard,t.gridProps.onClipboard]),Ct=()=>{var i,d,l;if(!R.canUseDOM)return!1;const e=R.getActiveElement(D()),n=e?e.matches(".k-table-td")?e:(i=D())==null?void 0:i.body:(d=D())==null?void 0:d.body,o=n.closest(".k-grid-container"),r=n&&((l=H.current)==null?void 0:l.contains(n));return!!(n&&r&&o)},It=(e,n,o,r,i,d,l)=>{ge(),ie.current=!0,Pe.current=!0,t.gridProps.onColumnResize&&m&&s(t.gridProps.onColumnResize,{columns:Z(),nativeEvent:r,targetColumnId:l,index:e,newWidth:n,oldWidth:o,end:i,target:w.current}),i&&se(d)},Et=()=>{var e;return{filter:t.gridProps.filter,sort:t.gridProps.sort,skip:t.gridProps.skip,take:(e=t.gridProps.take)!=null?e:t.gridProps.pageSize,group:t.gridProps.group}},P=e=>({nativeEvent:e&&e.nativeEvent,syntheticEvent:e,target:w.current}),wt=e=>({...e,nativeEvent:void 0,syntheticEvent:void 0,target:void 0,targetEvent:void 0,focusElement:void 0}),s=(e,n)=>{if(t.gridProps.isClient){e(n);return}e(wt(n))},yt=()=>{var e,n,o;if(q.current&&((e=q.current)==null?void 0:e.getElementsByClassName("k-grid-edit-row").length)>0){Re.current=!1,(n=document.activeElement)!=null&&n.closest(".k-grid-edit-row")?be.current=document.activeElement:be.current=void 0;const r=Array.from((o=q.current)==null?void 0:o.getElementsByClassName("k-grid-edit-row"));r.length>Ee.current.length?oe.current=r.filter(i=>!Ee.current.includes(i))[0]:r.length===1&&(oe.current=r[0],Re.current=!0),Ee.current=r}},x=()=>t.dataRef.filter(e=>e.rowType==="data").map(e=>e.dataItem),D=()=>{var e;if(R.canUseDOM)return((e=ne())==null?void 0:e.ownerDocument)||document},ne=()=>H.current,fe=a.useCallback(e=>{var r,i;if(!h.current||!((r=h.current)!=null&&r.container)||t.gridProps.scrollable==="none")return;N.current&&N.current.disconnect();const{rowIndex:n}=e,o=ne();if(K){const d=((i=h.current.rowHeightService)==null?void 0:i.offset(n))||0;h.current.container.scroll(0,d)}else if(o){const d=n<1?o.querySelector("tbody > tr:nth-child(1)"):o.querySelector(`tbody > tr:nth-child(${n+1})`);d&&V.current&&(V.current.scrollTop=d.offsetTop)}},[t.gridProps.scrollable]),Ae=e=>JSON.stringify(e.map(n=>({id:n.id,field:n.field,title:n.title,children:n.children}))),St=()=>Ae(At)===Ae(t.columnsRef),xt=()=>{ae.current=window.innerWidth,St()||B()},Dt=()=>{var d;const{virtualTotal:e,virtualPageSize:n,gridProps:o}=t,r=h.current,i=t.gridProps.rowHeight||((d=o.minRowHeightRef)==null?void 0:d.current)||0;r&&(r.fixedScroll=o.fixedScroll||!1,r.PageChange=dt,r.pageSize=n,r.scrollableVirtual=K,r.container=V.current,r.tableBody=q.current,r.scrollHeightContainer=Ge.current,r.table=A.current,(!r.rowHeightService||r.total!==e)&&i&&(r.total=e,r.rowHeightService=new R.RowHeightService(e,i)))},He=a.useCallback(e=>{const n={rowIndex:Ie.current};e.forEach(o=>{o.boundingClientRect.height!==o.intersectionRect.height&&fe(n)})},[fe]),B=()=>{t.gridProps.forceUpdate&&t.gridProps.forceUpdate()},kt=e=>e.left!==void 0?we!=="rtl"?{left:e.left,right:e.right}:{left:e.right,right:e.left}:{},w=a.useRef(null),h=a.useRef(void 0),k=a.useRef(void 0),M=a.useRef(void 0),T=a.useRef(void 0),F=a.useRef(void 0),re=a.useRef(void 0),N=a.useRef(null),q=a.useRef(null),Kt=a.useRef(null),V=a.useRef(null),A=a.useRef(null),me=a.useRef(null),H=a.useRef(null),Ge=a.useRef(null),W=a.useRef(null),_=a.useRef(null),Pe=a.useRef(!1),he=a.useRef(!1),oe=a.useRef(void 0),be=a.useRef(void 0),Re=a.useRef(!1),ie=a.useRef(!0),ve=a.useRef(0),Ce=a.useRef(void 0),Ie=a.useRef(void 0),Ee=a.useRef([]),Oe=a.useRef([]),ae=a.useRef(0),$=a.useRef(null),Mt=a.useRef(null),Tt=a.useRef(null),we=R.useDir(H),K=t.isVirtualScroll,At=a.useMemo(()=>a.Children.toArray(t.gridProps.children),[t.gridProps.children]),Le=t.gridProps.groupable===!0||typeof t.gridProps.groupable=="object"&&t.gridProps.groupable.enabled!==!1,C=c.getSelectionOptions(t.gridProps.selectable),ze=c.getEditableOptions(t.gridProps.editable),Ht=ae.current&&U&&ae.current<=U.medium&&t.gridProps.adaptive;return a.useMemo(()=>{c.tableKeyboardNavigation.onConstructor({navigatable:!!t.gridProps.navigatable,contextStateRef:T,navigationStateRef:F,idPrefix:t.id}),h.current=new jt.VirtualScroll},[]),a.useMemo(()=>{var e;(e=h.current)==null||e.reset()},[t.gridProps.scrollable,t.gridProps.total,t.gridProps.filter,t.gridProps.group,Le,t.gridProps.sort,t.gridProps.rowHeight]),a.useEffect(()=>(t.gridProps.clipboard&&(re.current=new c.ClipboardService(te),re.current.addEventListeners(D())),()=>{re.current&&re.current.removeEventListeners(D())}),[t.gridProps.onClipboard,t.gridProps.clipboard,te,D]),a.useEffect(()=>(t.gridProps.columnVirtualization&&!window.navigator.userAgent.match(Ut.SAFARI_REGEX)&&(me.current&&(me.current.style.display="block"),A.current&&(A.current.style.display="block")),Me(),ge(),R.setScrollbarWidth(),c.tableKeyboardNavigation.onComponentDidMount({scope:H.current||void 0,contextStateRef:T,navigationStateRef:F}),()=>{clearTimeout(Ce.current)}),[]),a.useEffect(()=>{var e;Me(),ge(),R.setScrollbarWidth(),K&&(Te(),vt(),(e=h.current)==null||e.update()),yt(),c.tableKeyboardNavigation.onComponentDidUpdate({scope:H.current||void 0,contextStateRef:T,navigationStateRef:F,focusFirst:he.current,newEditableRow:oe.current,singleEditRow:Re.current,lastActiveElement:be.current,navigatable:t.gridProps.navigatable}),he.current=!1,oe.current=void 0}),a.useEffect(()=>{if(R.canUseDOM){const e={rootMargin:"0px",threshold:.9};N.current=window.IntersectionObserver&&new window.IntersectionObserver(He,e)||null}},[He]),a.useEffect(()=>{var n;let e;return R.canUseDOM&&window.ResizeObserver&&(e=new window.ResizeObserver(()=>{xt(),K&&Te()}),e.observe((n=D())==null?void 0:n.body)),()=>{e==null||e.disconnect()}},[]),a.useImperativeHandle(w,()=>({get element(){return ne()},props:t.gridProps,get columns(){return Z()},scrollIntoView:e=>{var r;if(!((r=h.current)!=null&&r.container)||t.gridProps.scrollable==="none")return;const{rowIndex:n}=e;Ie.current=n;const o=ne();if(N.current&&o){N.current.disconnect();const i=o.querySelector(`[absolute-row-index="${Ie.current}"]`);i?N.current.observe(i):fe(e)}},fitColumns:e=>{k.current.dblClickHandler(null,e)},exportAsPdf:ce})),a.useImperativeHandle(t.gridRef,()=>w.current),a.useMemo(()=>{k.current=new Nt.ColumnResize(It)},[t.gridProps.onColumnResize,t.columnsRef]),a.useMemo(()=>{M.current=new qt.CommonDragLogic(ue,bt,Ke)},[t.gridProps.onColumnReorder,t.gridProps.onGroupChange,t.gridProps.group,t.columnsRef,t.gridProps.groupable]),k.current.resizable=t.gridProps.resizable||!1,k.current.columns=t.columnsRef,k.current.columnsState=R.cloneArray(t.columnsState),M.current.reorderable=t.gridProps.reorderable||!1,M.current.groupable=Le,M.current.columns=t.columnsRef,M.current.dir=we,Dt(),a.createElement(Wt.GridContext.Provider,{value:{isClient:m,rowReorder:j,activeDragRowDataItemRef:$,reorderRowDragTargetRef:Mt,reorderRowDropTargetRef:Tt,dir:we,getCellPositionStyle:kt,dataItemKey:t.gridProps.dataItemKey,columnsState:t.columnsState,columnsRef:t.columnsRef,onColumnsStateChange:se,groupable:t.gridProps.groupable,group:t.gridProps.group,defaultGroup:t.gridProps.defaultGroup,groupChange:le,selectionRelease:rt,pagerPageChange:gt,onContextMenu:Ue,rowClick:_e,rowDblClick:$e,cellClick:Qe,headerCellClick:xe,itemChange:pe,onDialogEditCancel:Je,onDialogEditSubmit:Xe,sortable:t.gridProps.sortable,sort:t.gridProps.sort,defaultSort:t.gridProps.defaultSort,sortChange:De,filterable:t.gridProps.filterable,filter:t.gridProps.filter,defaultFilter:t.gridProps.defaultFilter,filterOperators:t.gridProps.filterOperators||_t.operators,filterChange:ft,applyHighlightDescriptor:mt,highlight:t.gridProps.highlight,searchChange:Pt,exportAsPdf:ce,onHeaderSelectionChange:nt,columnGroupChange:Rt,onKeyDown:Be,onFocus:Ve,scrollHandler:je,selectionChange:et,mobileMode:Ht,adaptiveColumnMenuRef:ae.current,adpativeTitle:t.gridProps.adaptiveTitle,adaptive:t.gridProps.adaptive,dispatchDetailExpand:Ye,dispatchGroupExpand:Ze,columnResizeRef:k,dragLogicRef:M,navigationStateRef:F,tableElementRef:A,tableBodyElementRef:q,headerElementRef:Kt,containerElementRef:V,headTableElementRef:me,elementRef:H,virtualScrollHeightContainerRef:Ge,footerRef:W,headerRef:_,vsRef:h}},a.createElement(c.TableKeyboardNavigationContext.Provider,{value:T.current},t.children),a.createElement(Bt.GridContextMenu,{show:u.show&&(Y==null?void 0:Y.length),dataItem:u.dataItem,field:u.field,items:Y,offset:u.offset,onClose:L,onSelect:qe}),t.gridProps.pdf&&a.createElement(Vt.BasePDFExport,{gridProps:t.gridProps,innerGrid:t.innerGrid,pdf:typeof t.gridProps.pdf=="object"?t.gridProps.pdf:{},onPdfExport:ht,ref:e=>O.current=e}))};exports.GridClientWrapper=Qt;
