/**
 * @license
 *-------------------------------------------------------------------------------------------
 * Copyright Â© 2025 Progress Software Corporation. All rights reserved.
 * Licensed under commercial license. See LICENSE.md in the package root for more information
 *-------------------------------------------------------------------------------------------
 */
"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const ue=require("react"),g=require("@progress/kendo-react-common"),J=require("@progress/kendo-react-buttons"),f=require("@progress/kendo-svg-icons"),F=require("@progress/kendo-react-intl"),Q=require("@progress/kendo-react-layout"),c=require("../utils.js"),de=require("./ChatContext.js"),me=require("./elements/FileBox.js"),l=require("../../messages/index.js");function fe(r){const i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(r){for(const s in r)if(s!=="default"){const m=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(i,s,m.get?m:{enumerable:!0,get:()=>r[s]})}}return i.default=r,Object.freeze(i)}const t=fe(ue),L=t.forwardRef((r,i)=>{const{item:s,template:m,onRequestSelection:T,tabIndex:Z=-1,dateFormat:O="g",selected:o,allowMessageCollapse:b,messageToolbarActions:k,messageContextMenuActions:C,isSender:y}=r,{setReplyToMessage:x,messages:P,user:p,internalScrollContainerRef:h,onToolbarAction:D,onContextMenuAction:N,onFileAction:V,onDownload:d,fileActions:B,setShowCopyNotification:I,statusTemplate:S}=de.useChatContext(),[j,A]=t.useState(!1),[$,z]=t.useState(!1),[E,ee]=t.useState(!0),[te,K]=t.useState(!1),u=F.useLocalization(),W=t.useRef({left:0,top:0}),w=t.useCallback(()=>{s!=null&&s.text&&c.copyToClipboard(s.text),I&&(I(!0),setTimeout(()=>{I(!1)},3e3))},[s,I]),R=t.useCallback(e=>{e.stopPropagation(),ee(a=>!a)},[]),se=t.useCallback(()=>{K(!1)},[]),ae=t.useCallback(e=>{(e.key==="Tab"||e.key==="Enter"||e.key===" "||e.key==="ArrowUp"||e.key==="ArrowDown")&&K(!0)},[]),q=t.useRef(null);t.useEffect(()=>{o&&q.current&&q.current.focus()},[o]);const _=t.useCallback(e=>{W.current={left:e.pageX,top:e.pageY},e.preventDefault(),z(!0),A(!0)},[]),U=t.useCallback(()=>{z(!1),A(!1)},[]),M=t.useCallback((e,a)=>!e.isDeleted&&e.text?e.text:c.getDeletedMessageText(a,u),[u]),X=t.useCallback(e=>{var a;(a=e.item)!=null&&a.text&&(e.item.data.id==="copy"&&!s.isDeleted?w():e.item.data.id==="reply"&&x(s),N&&N(e.item.data,e,s)),A(!1)},[s,N,x,w]),Y=t.useCallback(()=>{if(s.replyToId){const e=c.getMessageById(P,s.replyToId);if(e){const a=n=>{n.preventDefault(),n.stopPropagation();const v=h==null?void 0:h.current;c.scrollToMessageById(e.id,v)};return t.createElement("div",{className:g.classNames("k-message-reference",c.isAuthor(p,e)?"k-message-reference-sender":"k-message-reference-receiver"),onClick:a},t.createElement("div",{className:"k-message-reference-content"},c.convertTextToLinkedContent(M(e,c.isAuthor(p,e)))))}}return null},[s.replyToId,P,p,M,h]),G=t.useCallback(()=>{const e=[{id:"reply",label:"Reply",svgIcon:f.undoIcon},{id:"copy",label:"Copy",svgIcon:f.copyIcon}],a=C?[...e.map(n=>C.find(ie=>ie.id===n.id)||n),...C.filter(n=>!e.some(v=>v.id===n.id))]:e;return t.createElement(Q.ContextMenu,{onSelect:X,onClose:U,vertical:!0,show:j,offset:W.current},a.map(n=>n.id==="delete"&&!y?null:t.createElement(Q.MenuItem,{key:n.id,text:n.label,icon:n.icon,svgIcon:n.svgIcon,data:n})))},[C,X,U,j,y]),H=t.useCallback(()=>s.files&&s.files.length>1?t.createElement("div",{className:"k-chat-download-button-wrapper"},t.createElement(J.Button,{className:"k-chat-download-button",fillMode:"flat",themeColor:"base",svgIcon:f.downloadIcon,onClick:e=>{e.stopPropagation(),d&&d(s.files,s)},"aria-label":u.toLanguageString(l.downloadAllFiles,l.messages[l.downloadAllFiles])},t.createElement("span",{className:"k-button-text"},u.toLanguageString(l.downloadAll,l.messages[l.downloadAll])))):null,[s,d,u]),ne=t.useCallback(()=>{if(s.typing)return t.createElement("div",{className:"k-bubble k-chat-bubble"},t.createElement("div",{className:"k-typing-indicator"},t.createElement("span",null),t.createElement("span",null),t.createElement("span",null)));if(m){const e=m;return t.createElement(e,{item:s})}else if(s.text||s.files&&s.files.length>0)return t.createElement(t.Fragment,null,t.createElement("div",{className:g.classNames("k-chat-bubble","k-bubble",{"k-bubble-expandable":b,"k-expanded":b&&E,"k-selected":o,"k-active":$}),onClick:()=>T(o?void 0:s.selectionIndex),onContextMenu:_},t.createElement("div",{className:"k-bubble-content"},t.createElement("span",{className:"k-chat-bubble-text"},!s.isDeleted&&Y(),c.convertTextToLinkedContent(M(s,c.isAuthor(p,s)))),s.files&&t.createElement(me,{files:s.files,message:s,onFileAction:V,onDownload:e=>d==null?void 0:d(e,s),renderInTextarea:!1,fileActions:B}),H()),b&&t.createElement("span",{className:"k-bubble-expandable-indicator",onClick:R,role:"button","aria-label":E?u.toLanguageString(l.collapseMessage,l.messages[l.collapseMessage]):u.toLanguageString(l.expandMessage,l.messages[l.expandMessage]),tabIndex:0,onKeyDown:e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),R(e))}},t.createElement(g.IconWrap,{icon:E?f.chevronUpIcon:f.chevronDownIcon,size:"medium"}))),G());return null},[s,m,b,E,o,_,Y,M,p,V,B,H,R,u,G,d]),le=t.useCallback(()=>{let e=null;return s.timestamp&&(e=t.createElement("time",{className:"k-message-time","aria-hidden":!o},F.provideIntlService({props:r}).formatDate(s.timestamp,O))),e},[s.timestamp,o,O,r]),oe=t.useCallback(()=>{let e=null;return s.status&&o&&(S?e=t.createElement(S,{item:s}):e=t.createElement("span",{className:"k-message-status"},t.createElement(g.IconWrap,{icon:f.checkCircleIcon,size:"xsmall"}),s.status)),e},[s,o,S]),re=t.useCallback(()=>g.classNames({"k-focus":o,"k-message-removed":s.isDeleted},"k-message"),[o,s.isDeleted]),ce=t.useCallback(()=>k&&k.length>0&&t.createElement("div",{className:"k-chat-message-toolbar k-toolbar k-toolbar-md k-toolbar-flat"},k.map(e=>e.id==="delete"&&!y?null:t.createElement(J.Button,{key:e.id,fillMode:"flat",className:"k-toolbar-button",themeColor:"base",icon:e.icon,svgIcon:e.svgIcon,onClick:a=>{a.stopPropagation(),e.id==="copy"&&!s.isDeleted?w():e.id==="reply"&&x(s),D&&D(e,a,s)},onMouseDown:a=>a.preventDefault()}))),[w,y,s,k,D,x]);return t.createElement("div",{"data-message-id":s.id,className:re(),tabIndex:Z,onMouseDown:se,onKeyDown:ae,onFocus:e=>{te&&T(s.selectionIndex)},ref:e=>{q.current=e,typeof i=="function"?i(e):i&&(i.current=e)}},le(),ne(),oe(),ce())});L.displayName="ChatMessage";class pe extends t.Component{render(){return t.createElement(L,{...this.props})}}F.registerForIntl(pe);exports.ChatMessage=L;
